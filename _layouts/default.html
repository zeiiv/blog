---
---

<!doctype html>
{% include copyright.html %}
<html lang="{{ site.locale | replace: " _", "-" | default: "en" }}" class="no-js">

<head>
  {% include head.html %}
  {% include head/custom.html %}
</head>

<body
  class="layout--{{ page.layout | default: layout.layout }} skin--{{ site.minimal_mistakes_skin | default: 'default' }} lang--{{ page.lang | default: site.lang }}{% if page.classes or layout.classes %}{{ page.classes | default: layout.classes | join: ' ' | prepend: ' ' }}{% endif %}"
  dir="{% if page.rtl %}rtl{% else %}ltr{% endif %}"></body>

{% include_cached skip-links.html %}
{% include header__wordplay.html %}

<div data-barba="wrapper">
  <main data-barba="container" class="initial-content">
    {{ content }}
    {% include after-content.html %}
  </main>
</div>

{% if site.search == true %}
<div class="search-content">
  {% include_cached search/search_form.html %}
</div>
{% endif %}

<div id="footer" class="page__footer">
  <footer>
    {% include footer/custom.html %}
    {% include_cached footer.html %}
  </footer>
</div>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@barba/core@2.9.7/dist/barba.umd.min.js"></script>
<script src="{{ '/assets/js/lang-switch.js' | relative_url }}"></script>
<script src="{{ '/assets/js/wordplay.js' | relative_url }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const BASE_URL = '/blog';

    const wordSwapTransition = {
      name: 'word-swap',
      // NO "sync: true" here. This makes the transition asynchronous.

      // This `leave` function is called when a link is clicked
      leave(data) {
        // Only run this animation if a word in the `.wordpile` was clicked
        if (data.trigger.closest && data.trigger.closest('.wordpile')) {
          console.log('Leaving page with custom word-swap transition.');
          
          // Start the animation, but DO NOT wait for it to finish.
          createWordSwapAnimation(data.trigger);

          // Return a promise that resolves after a short delay (e.g., 150ms).
          // Barba will wait for this short delay and then load the next page,
          // while the rest of the GSAP animation continues to play.
          return new Promise(resolve => {
            setTimeout(resolve, 150);
          });
        }
      },

      enter(data) {
        console.log('Entering new page.');
        // You can add an animation for the new content appearing here.
        // For example, a simple fade-in:
        gsap.from(data.next.container, {
          opacity: 0,
          duration: 0.4
        });
      }
    };

    barba.init({
      debug: true, // Set to false for production
      transitions: [
        wordSwapTransition
      ],
      // The request logic to fix the baseurl remains the same.
      request: (url, { trigger, method, headers }) => {
        const urlObject = new URL(url);
        if (!urlObject.pathname.startsWith(BASE_URL)) {
          const correctedPath = BASE_URL + urlObject.pathname;
          console.warn(`Corrected URL from ${urlObject.pathname} to ${correctedPath}`);
          return fetch(correctedPath, { method, headers });
        }
        return fetch(url, { method, headers });
      }
    });

    barba.hooks.after(() => {
      document.querySelectorAll('.clicked-once').forEach(el => el.classList.remove('clicked-once'));
    });
  });
</script>
{% include scripts.html %}
</body>

</html>
{% include scripts.html %}
</body>

</html>