---
---

<!doctype html>
{% include copyright.html %}
<html lang="{{ site.locale | replace: " _", "-" | default: "en" }}" class="no-js">

<head>
  {% include head.html %}
  {% include head/custom.html %}
</head>

<body
  class="layout--{{ page.layout | default: layout.layout }} skin--{{ site.minimal_mistakes_skin | default: 'default' }} lang--{{ page.lang | default: site.lang }}{% if page.classes or layout.classes %}{{ page.classes | default: layout.classes | join: ' ' | prepend: ' ' }}{% endif %}"
  dir="{% if page.rtl %}rtl{% else %}ltr{% endif %}"></body>

{% include_cached skip-links.html %}
{% include header__wordplay.html %}

<div data-barba="wrapper">
  <main data-barba="container" class="initial-content">
    {{ content }}
    {% include after-content.html %}
  </main>
</div>

{% if site.search == true %}
<div class="search-content">
  {% include_cached search/search_form.html %}
</div>
{% endif %}

<div id="footer" class="page__footer">
  <footer>
    {% include footer/custom.html %}
    {% include_cached footer.html %}
  </footer>
</div>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@barba/core@2.9.7/dist/barba.umd.min.js"></script>
<script src="{{ '/assets/js/lang-switch.js' | relative_url }}"></script>
<script src="{{ '/assets/js/wordplay.js' | relative_url }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // The base URL of your site from the Jekyll config.
    const BASE_URL = '/blog';

    // This is our custom transition that uses the GSAP animation.
    const wordSwapTransition = {
      name: 'word-swap',
      // This hook is called when a link is clicked.
      // `data.trigger` is the link element that was clicked.
      leave(data) {
        // We only run this animation if a word in the `.wordpile` was clicked.
        if (data.trigger.closest && data.trigger.closest('.wordpile')) {
          console.log('Leaving page with custom word-swap transition.');
          // Call the animation function from wordplay.js and return the GSAP timeline.
          // Barba will wait for the animation to finish.
          return createWordSwapAnimation(data.trigger);
        }
        // For all other links, do nothing and let Barba perform its default transition.
      },
      enter(data) {
        console.log('Entering new page.');
      }
    };

    // Initialize Barba with our custom transition.
    barba.init({
      debug: true, // Set to false for production
      transitions: [
        wordSwapTransition
      ],
      // This part is crucial for fixing the Fetch error.
      // We are creating a custom "request" logic.
      request: (url, { trigger, method, headers }) => {
        // Create a URL object to easily parse the requested URL.
        const urlObject = new URL(url);

        // Check if the path is missing the baseurl and if it's not already there.
        if (!urlObject.pathname.startsWith(BASE_URL)) {
          // If it's missing, prepend the baseurl to the path.
          const correctedPath = BASE_URL + urlObject.pathname;
          console.warn(`Corrected URL from ${urlObject.pathname} to ${correctedPath}`);
          // Return the fetch promise with the corrected URL.
          return fetch(correctedPath, { method, headers });
        }

        // If the URL is already correct, just let fetch proceed normally.
        return fetch(url, { method, headers });
      }
    });

    // This hook runs after Barba has loaded the new page content.
    barba.hooks.after(() => {
      // Reset the 'clicked-once' class on any links that have it.
      document.querySelectorAll('.clicked-once').forEach(el => el.classList.remove('clicked-once'));
    });

  });
</script>
{% include scripts.html %}
</body>

</html>
{% include scripts.html %}
</body>

</html>